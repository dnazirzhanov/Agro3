{% extends 'base.html' %}

{% block title %}Find Farmers - Batken Agri-Helper{% endblock %}

{% block extra_css %}
<style>
.follow-btn {
  transition: all 0.2s ease;
}

.follow-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.farmer-card {
  transition: all 0.2s ease;
}

.farmer-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
}
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
  <div class="col-12 d-flex justify-content-between align-items-center">
    <h1 class="h3"><i class="bi bi-people me-2"></i>Find Farmers</h1>
    <a href="{% url 'users:dashboard' %}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left me-1"></i> Back to Dashboard
    </a>
  </div>
</div>

<!-- Filters -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <form method="get" class="row g-3">
      <div class="col-md-3">
        <label class="form-label">Region</label>
        <select name="region" class="form-select">
          <option value="">All</option>
          {% for value, label in regions %}
            <option value="{{ value }}" {% if current_filters.region == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Farmer Type</label>
        <select name="farmer_type" class="form-select">
          <option value="">All</option>
          {% for value, label in farmer_types %}
            <option value="{{ value }}" {% if current_filters.farmer_type == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Experience</label>
        <select name="experience" class="form-select">
          <option value="">All</option>
          <option value="beginner" {% if current_filters.experience == 'beginner' %}selected{% endif %}>Beginner (0-1 years)</option>
          <option value="novice" {% if current_filters.experience == 'novice' %}selected{% endif %}>Novice (1-3 years)</option>
          <option value="intermediate" {% if current_filters.experience == 'intermediate' %}selected{% endif %}>Intermediate (3-9 years)</option>
          <option value="experienced" {% if current_filters.experience == 'experienced' %}selected{% endif %}>Experienced (9-15 years)</option>
          <option value="expert" {% if current_filters.experience == 'expert' %}selected{% endif %}>Expert (15+ years)</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Search</label>
        <input type="text" name="search" value="{{ current_filters.search }}" class="form-control" placeholder="Search by name or bio">
      </div>
      <div class="col-12 d-flex justify-content-end">
        <a href="{% url 'users:farmers_list' %}" class="btn btn-outline-secondary me-2">Clear</a>
        <button class="btn btn-success" type="submit"><i class="bi bi-search me-1"></i>Search</button>
      </div>
    </form>
  </div>
</div>

<!-- Results -->
{% if farmers %}
  <div class="row g-3">
    {% for farmer_data in farmers %}
      {% with fp=farmer_data.profile %}
      <div class="col-md-6">
        <div class="card shadow-sm h-100 farmer-card">
          <div class="card-body d-flex">
            <div class="me-3">
                <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" style="width:60px;height:60px;">
                  <span class="user-avatar" style="font-size: 2.5rem;">{{ fp.get_avatar_emoji }}</span>
                </div>
            </div>
            <div class="flex-grow-1">
              <h5 class="mb-1">
                <a href="{% url 'users:profile' fp.user.pk %}" class="text-decoration-none">
                  {{ fp.get_full_name|default:fp.user.username }}
                </a>
              </h5>
              <div class="text-muted small mb-2">
                {{ fp.get_farmer_type_display }} â€¢ {{ fp.get_region_display }}
              </div>
              {% if farmer_data.follower_count > 0 %}
              <div class="small mb-2">
                <span class="badge bg-light text-dark">
                  <i class="bi bi-people-fill text-primary"></i> {{ farmer_data.follower_count }} follower{{ farmer_data.follower_count|pluralize }}
                </span>
              </div>
              {% endif %}
              <div class="small">
                <strong>Experience:</strong> {{ fp.get_experience_level }}
              </div>
              {% if fp.bio %}
              <div class="small text-muted mt-1">
                {{ fp.bio|truncatewords:15 }}
              </div>
              {% endif %}
            </div>
          </div>
          <div class="card-footer d-flex justify-content-between align-items-center">
            <small class="text-muted">Last active {{ fp.last_activity|timesince }} ago</small>
            {% if farmer_data.is_following %}
              <a href="{% url 'users:follow' fp.user.pk %}?next=farmers_list" class="btn btn-sm btn-success follow-btn" title="Click to unfollow">
                <i class="bi bi-check-circle-fill"></i> Following
              </a>
            {% else %}
              <a href="{% url 'users:follow' fp.user.pk %}?next=farmers_list" class="btn btn-sm btn-outline-primary follow-btn" title="Click to follow this farmer">
                <i class="bi bi-person-plus"></i> Follow
              </a>
            {% endif %}
          </div>
        </div>
      </div>
      {% endwith %}
    {% endfor %}
  </div>
{% else %}
  <div class="text-center py-5">
    <i class="bi bi-people text-muted mb-3" style="font-size:3rem;"></i>
    <h4 class="text-muted">No farmers match your filters</h4>
    <p class="text-muted">Try adjusting your filters or search terms.</p>
  </div>
{% endif %}
{% endblock %}