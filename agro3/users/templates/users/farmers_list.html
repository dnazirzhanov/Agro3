{% extends 'base.html' %}

{% block title %}Find Farmers - Batken Agri-Helper{% endblock %}

{% block content %}
<div class="row mb-4">
  <div class="col-12 d-flex justify-content-between align-items-center">
    <h1 class="h3"><i class="bi bi-people me-2"></i>Find Farmers</h1>
    <a href="{% url 'users:dashboard' %}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left me-1"></i> Back to Dashboard
    </a>
  </div>
</div>

<!-- Filters -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <form method="get" class="row g-3">
      <div class="col-md-3">
        <label class="form-label">Region</label>
        <select name="region" class="form-select">
          <option value="">All</option>
          {% for value, label in regions %}
            <option value="{{ value }}" {% if current_filters.region == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Farmer Type</label>
        <select name="farmer_type" class="form-select">
          <option value="">All</option>
          {% for value, label in farmer_types %}
            <option value="{{ value }}" {% if current_filters.farmer_type == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Experience</label>
        <select name="experience" class="form-select">
          <option value="">All</option>
          <option value="beginner" {% if current_filters.experience == 'beginner' %}selected{% endif %}>Beginner</option>
          <option value="intermediate" {% if current_filters.experience == 'intermediate' %}selected{% endif %}>Intermediate</option>
          <option value="experienced" {% if current_filters.experience == 'experienced' %}selected{% endif %}>Experienced</option>
          <option value="expert" {% if current_filters.experience == 'expert' %}selected{% endif %}>Expert</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Search</label>
        <input type="text" name="search" value="{{ current_filters.search }}" class="form-control" placeholder="Name or crops">
      </div>
      <div class="col-12 d-flex justify-content-end">
        <a href="{% url 'users:farmers_list' %}" class="btn btn-outline-secondary me-2">Clear</a>
        <button class="btn btn-success" type="submit"><i class="bi bi-search me-1"></i>Search</button>
      </div>
    </form>
  </div>
</div>

<!-- Results -->
{% if farmers %}
  <div class="row g-3">
    {% for fp in farmers %}
      <div class="col-md-6">
        <div class="card shadow-sm h-100">
          <div class="card-body d-flex">
            <div class="me-3">
              {% if fp.avatar %}
                <img src="{{ fp.avatar.url }}" class="rounded-circle" style="width:60px;height:60px;object-fit:cover;" alt="Avatar">
              {% else %}
                <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" style="width:60px;height:60px;">
                  <i class="bi bi-person text-muted"></i>
                </div>
              {% endif %}
            </div>
            <div class="flex-grow-1">
              <h5 class="mb-1">
                <a href="{% url 'users:profile' fp.user.pk %}" class="text-decoration-none">
                  {{ fp.get_full_name|default:fp.user.username }}
                </a>
              </h5>
              <div class="text-muted small mb-2">
                {{ fp.get_farmer_type_display }} • {{ fp.get_region_display }}
              </div>
              <div class="small">
                <strong>Main Crops:</strong> {{ fp.main_crops|default:"—" }}
              </div>
              <div class="small">
                <strong>Experience:</strong> {{ fp.farming_experience }} years ({{ fp.get_experience_level }})
              </div>
            </div>
          </div>
          <div class="card-footer d-flex justify-content-between align-items-center">
            <small class="text-muted">Last active {{ fp.last_activity|timesince }} ago</small>
            <a href="{% url 'users:follow' fp.user.pk %}" class="btn btn-sm btn-outline-primary">
              <i class="bi bi-person-plus"></i> Follow
            </a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="text-center py-5">
    <i class="bi bi-people text-muted mb-3" style="font-size:3rem;"></i>
    <h4 class="text-muted">No farmers match your filters</h4>
    <p class="text-muted">Try adjusting your filters or search terms.</p>
  </div>
{% endif %}
{% endblock %}