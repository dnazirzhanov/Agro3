{% extends 'base.html' %}

{% block title %}{{ market.name }} - Market Details{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'market:price_list' %}">Market Prices</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{ market.name }}</li>
            </ol>
        </nav>
    </div>
</div>

<!-- Market Header -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h1 class="mb-3">
                            <i class="bi bi-shop text-primary me-2"></i>{{ market.name }}
                        </h1>
                        <div class="mb-2">
                            <i class="bi bi-geo-alt-fill text-muted me-2"></i>
                            <span class="text-muted">{{ market.location }}</span>
                        </div>
                        {% if market.contact_info %}
                        <div class="mb-2">
                            <i class="bi bi-telephone-fill text-muted me-2"></i>
                            <span class="text-muted">{{ market.contact_info }}</span>
                        </div>
                        {% endif %}
                        {% if market.description %}
                        <div class="mt-3">
                            <p class="text-muted">{{ market.description }}</p>
                        </div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="alert alert-info mb-0">
                            <h3 class="mb-0">{{ prices.paginator.count }}</h3>
                            <small>Products Available</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Products and Prices Table -->
<div class="row">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-basket me-2"></i>Products and Prices
                </h5>
                <small class="text-muted">Latest prices for each product</small>
            </div>
            <div class="card-body p-0">
                {% if prices %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th><i class="bi bi-basket me-1"></i>Product</th>
                                <th><i class="bi bi-tag me-1"></i>Category</th>
                                <th><i class="bi bi-currency-exchange me-1"></i>Price</th>
                                <th><i class="bi bi-box me-1"></i>Unit</th>
                                <th><i class="bi bi-calendar me-1"></i>Last Updated</th>
                                <th><i class="bi bi-chat-text me-1"></i>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for price in prices %}
                            <tr>
                                <td>
                                    <div class="fw-bold text-success">{{ price.product.name }}</div>
                                </td>
                                <td>
                                    {% if price.product.category %}
                                        <span class="badge bg-secondary">{{ price.product.category }}</span>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-primary fs-6">
                                        {{ price.price|floatformat:2 }} som
                                    </span>
                                </td>
                                <td>
                                    <span class="text-muted">per {{ price.get_unit_display }}</span>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        <i class="bi bi-clock me-1"></i>
                                        {{ price.date_recorded|date:"M d, Y" }}
                                        <br>
                                        {{ price.date_recorded|date:"g:i A" }}
                                    </small>
                                </td>
                                <td>
                                    {% if price.notes %}
                                        <small class="text-muted">{{ price.notes|truncatewords:10 }}</small>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                {% if prices.has_other_pages %}
                <div class="card-footer">
                    <nav aria-label="Price pagination">
                        <ul class="pagination justify-content-center mb-0">
                            {% if prices.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ prices.previous_page_number }}">
                                        <i class="bi bi-chevron-left"></i> Previous
                                    </a>
                                </li>
                            {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link">
                                        <i class="bi bi-chevron-left"></i> Previous
                                    </span>
                                </li>
                            {% endif %}
                            
                            <li class="page-item active">
                                <span class="page-link">
                                    Page {{ prices.number }} of {{ prices.paginator.num_pages }}
                                </span>
                            </li>
                            
                            {% if prices.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ prices.next_page_number }}">
                                        Next <i class="bi bi-chevron-right"></i>
                                    </a>
                                </li>
                            {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link">
                                        Next <i class="bi bi-chevron-right"></i>
                                    </span>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
                {% endif %}
                
                {% else %}
                <div class="p-5 text-center">
                    <i class="bi bi-inbox display-1 text-muted"></i>
                    <p class="lead mt-3">No products found for this market.</p>
                    <p class="text-muted">Products will appear here once prices are added by administrators.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card bg-light">
            <div class="card-body text-center">
                <h5>Explore More</h5>
                <div class="btn-group" role="group">
                    <a href="{% url 'market:price_list' %}" class="btn btn-outline-primary">
                        <i class="bi bi-list me-1"></i>All Market Prices
                    </a>
                    <a href="{% url 'market:price_comparison' %}" class="btn btn-outline-info">
                        <i class="bi bi-bar-chart me-1"></i>Compare Prices
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
