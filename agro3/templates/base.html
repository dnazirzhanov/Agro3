{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% trans "Batken Agri-Helper" %}{% endblock %}</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Avatar Styles -->
    <style>
    .user-avatar {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
        font-size: 1.5rem;
        line-height: 1;
    }

    .user-avatar-lg {
        width: 80px;
        height: 80px;
        font-size: 3rem;
    }

    .user-avatar-sm {
        width: 30px;
        height: 30px;
        font-size: 1.2rem;
    }
    
    .user-avatar-xs {
        width: 24px;
        height: 24px;
        font-size: 1rem;
    }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <div class="container">
            <a class="navbar-brand fw-bold" href="{% url 'home' %}">
                <i class="bi bi-tree me-2"></i>{% trans "Batken Agri-Helper" %}
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'home' %}">
                            <i class="bi bi-house me-1"></i>{% trans "Home" %}
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-flower3 me-1"></i>{% trans "Crops" %}
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{% url 'crops:list' %}">{% trans "All Crops" %}</a></li>
                            <li><a class="dropdown-item" href="{% url 'soil:questionnaire' %}">{% trans "Soil Types" %}</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-bug me-1"></i>{% trans "Pests & Diseases" %}
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{% url 'pests_diseases:list' %}">{% trans "All Pests & Diseases" %}</a></li>
                            <li><a class="dropdown-item" href="{% url 'pests_diseases:dose_calculator' %}">{% trans "Dose Calculator" %}</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'market:price_list' %}">
                            <i class="bi bi-graph-up me-1"></i>{% trans "Market Prices" %}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'weather:dashboard' %}">
                            <i class="bi bi-cloud-sun me-1"></i>{% trans "Weather" %}
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'forum:index' %}">
                            <i class="bi bi-people me-1"></i>{% trans "Community" %}
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-capsule-pill me-1"></i>{% trans "Agro Supplies" %}
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{% url 'agro_supplies:product_list' %}"><i class="bi bi-flask me-2"></i>{% trans "Chemical Products" %}</a></li>
                            <li><a class="dropdown-item" href="{% url 'agro_supplies:shop_list' %}"><i class="bi bi-shop me-2"></i>{% trans "Shops & Vendors" %}</a></li>
                            <li><a class="dropdown-item" href="{% url 'agro_supplies:price_comparison' %}"><i class="bi bi-bar-chart-line me-2"></i>{% trans "Price Comparison" %}</a></li>
                        </ul>
                    </li>
                    
                    <!-- Language Switcher -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-globe me-1"></i>
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'ru' %}
                                Русский
                            {% elif LANGUAGE_CODE == 'ky' %}
                                Кыргызча
                            {% else %}
                                English
                            {% endif %}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            {% get_available_languages as languages %}
                            {% get_current_language as current_lang %}
                            {% for lang_code, lang_name in languages %}
                                {% if lang_code != current_lang %}
                                    <li>
                                        <form action="{% url 'set_language' %}" method="post" class="d-inline">
                                            {% csrf_token %}
                                            <input name="next" type="hidden" value="{{ request.get_full_path }}">
                                            <input name="language" type="hidden" value="{{ lang_code }}">
                                            <button type="submit" class="dropdown-item">
                                                {% if lang_code == 'en' %}
                                                    <i class="bi bi-flag me-2"></i>English
                                                {% elif lang_code == 'ru' %}
                                                    <i class="bi bi-flag me-2"></i>Русский
                                                {% elif lang_code == 'ky' %}
                                                    <i class="bi bi-flag me-2"></i>Кыргызча
                                                {% endif %}
                                            </button>
                                        </form>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </li>
                </ul>
                
                <!-- User Authentication -->
                <div class="navbar-nav ms-auto">
                    {% if user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                                <span class="user-avatar me-2" style="font-size: 1.8rem;">{{ user.profile.get_avatar_emoji }}</span>
                                {{ user.get_full_name|default:user.username }}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="{% url 'users:dashboard' %}">
                                    <i class="bi bi-speedometer2 me-2"></i>{% trans "Dashboard" %}
                                </a></li>
                                <li><a class="dropdown-item" href="{% url 'users:profile_edit' %}">
                                    <i class="bi bi-person-gear me-2"></i>{% trans "Edit Profile" %}
                                </a></li>
                                <li><a class="dropdown-item" href="{% url 'users:profile' user.pk %}">
                                    <i class="bi bi-person me-2"></i>{% trans "View Profile" %}
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{% url 'users:farmers_list' %}">
                                    <i class="bi bi-people me-2"></i>{% trans "Find Farmers" %}
                                </a></li>
                                {% if user.is_staff %}
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="{% url 'admin:index' %}">
                                        <i class="bi bi-gear me-2"></i>{% trans "Admin Panel" %}
                                    </a></li>
                                {% endif %}
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{% url 'users:logout' %}">
                                    <i class="bi bi-box-arrow-right me-2"></i>{% trans "Logout" %}
                                </a></li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'users:login' %}">
                                <i class="bi bi-box-arrow-in-right me-1"></i>{% trans "Login" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn btn-success text-white ms-2 px-3" href="{% url 'users:register' %}">
                                <i class="bi bi-person-plus me-1"></i>{% trans "Register" %}
                            </a>
                        </li>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="py-4">
        <div class="container">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
            
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="bi bi-tree me-2"></i>{% trans "Batken Agri-Helper" %}</h5>
                    <p class="mb-0">{% trans "Empowering farmers in Batken region, Kyrgyzstan with data-driven agricultural solutions." %}</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">{% trans "&copy; 2025 Batken Agri-Helper. Built for the farming community." %}</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>